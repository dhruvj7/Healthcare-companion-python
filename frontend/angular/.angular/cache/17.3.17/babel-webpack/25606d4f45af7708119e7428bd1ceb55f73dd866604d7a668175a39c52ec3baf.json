{"ast":null,"code":"// src/app/services/chat.service.ts\nimport { __decorate } from \"tslib\";\nimport { Injectable } from '@angular/core';\nimport { Observable, BehaviorSubject, throwError } from 'rxjs';\nimport { catchError, tap } from 'rxjs/operators';\nimport { environment } from '../../environments/environment';\nlet ChatService = class ChatService {\n  http;\n  apiUrl = `${environment.apiUrl}/chat`;\n  sessionId = null;\n  // BehaviorSubject to manage conversation state\n  messagesSubject = new BehaviorSubject([]);\n  messages$ = this.messagesSubject.asObservable();\n  constructor(http) {\n    this.http = http;\n    this.loadSessionFromStorage();\n  }\n  /**\n   * Send a message to the unified chat API\n   */\n  sendMessage(message, context) {\n    const request = {\n      message,\n      session_id: this.sessionId || undefined,\n      context\n    };\n    // Add user message to UI immediately\n    this.addMessage({\n      role: 'user',\n      content: message,\n      timestamp: new Date().toISOString()\n    });\n    // Add loading message\n    this.addMessage({\n      role: 'assistant',\n      content: '...',\n      timestamp: new Date().toISOString(),\n      isLoading: true\n    });\n    return this.http.post(`${this.apiUrl}/chat`, request).pipe(tap(response => {\n      // Store session ID\n      if (response.session_id) {\n        this.sessionId = response.session_id;\n        this.saveSessionToStorage();\n      }\n      // Remove loading message\n      this.removeLoadingMessage();\n      // Add assistant response\n      this.addMessage({\n        role: 'assistant',\n        content: this.formatResponseMessage(response),\n        timestamp: response.timestamp,\n        intent: response.intent,\n        confidence: response.confidence\n      });\n    }), catchError(error => {\n      this.removeLoadingMessage();\n      this.addMessage({\n        role: 'assistant',\n        content: '❌ Sorry, I encountered an error processing your request. Please try again.',\n        timestamp: new Date().toISOString()\n      });\n      return throwError(() => error);\n    }));\n  }\n  /**\n   * Get system capabilities\n   */\n  getCapabilities() {\n    return this.http.get(`${this.apiUrl}/capabilities`);\n  }\n  /**\n   * Get conversation history\n   */\n  getConversationHistory() {\n    if (!this.sessionId) {\n      return throwError(() => new Error('No active session'));\n    }\n    return this.http.get(`${this.apiUrl}/conversation/${this.sessionId}`);\n  }\n  /**\n   * Clear conversation\n   */\n  clearConversation() {\n    if (this.sessionId) {\n      return this.http.delete(`${this.apiUrl}/conversation/${this.sessionId}`).pipe(tap(() => {\n        this.sessionId = null;\n        this.messagesSubject.next([]);\n        this.clearSessionFromStorage();\n      }));\n    }\n    // If no session, just clear local messages\n    this.messagesSubject.next([]);\n    return new Observable(observer => {\n      observer.next();\n      observer.complete();\n    });\n  }\n  /**\n   * Get current session ID\n   */\n  getSessionId() {\n    return this.sessionId;\n  }\n  /**\n   * Format response message for display\n   */\n  formatResponseMessage(response) {\n    let message = response.result.message;\n    // Add follow-up questions if any\n    if (response.follow_up_questions && response.follow_up_questions.length > 0) {\n      message += '\\n\\n**Follow-up questions:**\\n';\n      response.follow_up_questions.forEach((q, i) => {\n        message += `${i + 1}. ${q}\\n`;\n      });\n    }\n    return message;\n  }\n  /**\n   * Add message to conversation\n   */\n  addMessage(message) {\n    const currentMessages = this.messagesSubject.value;\n    this.messagesSubject.next([...currentMessages, message]);\n  }\n  /**\n   * Remove loading message\n   */\n  removeLoadingMessage() {\n    const currentMessages = this.messagesSubject.value;\n    const filtered = currentMessages.filter(m => !m.isLoading);\n    this.messagesSubject.next(filtered);\n  }\n  /**\n   * Save session to localStorage\n   */\n  saveSessionToStorage() {\n    if (this.sessionId) {\n      localStorage.setItem('healthcare_session_id', this.sessionId);\n    }\n  }\n  /**\n   * Load session from localStorage\n   */\n  loadSessionFromStorage() {\n    const stored = localStorage.getItem('healthcare_session_id');\n    if (stored) {\n      this.sessionId = stored;\n    }\n  }\n  /**\n   * Clear session from localStorage\n   */\n  clearSessionFromStorage() {\n    localStorage.removeItem('healthcare_session_id');\n  }\n};\nChatService = __decorate([Injectable({\n  providedIn: 'root'\n})], ChatService);\nexport { ChatService };","map":{"version":3,"names":["Injectable","Observable","BehaviorSubject","throwError","catchError","tap","environment","ChatService","http","apiUrl","sessionId","messagesSubject","messages$","asObservable","constructor","loadSessionFromStorage","sendMessage","message","context","request","session_id","undefined","addMessage","role","content","timestamp","Date","toISOString","isLoading","post","pipe","response","saveSessionToStorage","removeLoadingMessage","formatResponseMessage","intent","confidence","error","getCapabilities","get","getConversationHistory","Error","clearConversation","delete","next","clearSessionFromStorage","observer","complete","getSessionId","result","follow_up_questions","length","forEach","q","i","currentMessages","value","filtered","filter","m","localStorage","setItem","stored","getItem","removeItem","__decorate","providedIn"],"sources":["C:\\Users\\MDSaifUddinSiddiqui\\Healthcare-companion-python\\frontend\\angular\\src\\app\\services\\chat.service.ts"],"sourcesContent":["// src/app/services/chat.service.ts\r\n\r\nimport { Injectable } from '@angular/core';\r\nimport { HttpClient, HttpErrorResponse } from '@angular/common/http';\r\nimport { Observable, BehaviorSubject, throwError } from 'rxjs';\r\nimport { catchError, tap } from 'rxjs/operators';\r\nimport { environment } from '../../environments/environment';\r\nimport {\r\n  ChatRequest,\r\n  ChatResponse,\r\n  Message,\r\n  Capability,\r\n  ConversationHistory\r\n} from '../models/chat.models';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ChatService {\r\n  private apiUrl = `${environment.apiUrl}/chat`;\r\n  private sessionId: string | null = null;\r\n\r\n  // BehaviorSubject to manage conversation state\r\n  private messagesSubject = new BehaviorSubject<Message[]>([]);\r\n  public messages$ = this.messagesSubject.asObservable();\r\n\r\n  constructor(private http: HttpClient) {\r\n    this.loadSessionFromStorage();\r\n  }\r\n\r\n  /**\r\n   * Send a message to the unified chat API\r\n   */\r\n  sendMessage(message: string, context?: Record<string, any>): Observable<ChatResponse> {\r\n    const request: ChatRequest = {\r\n      message,\r\n      session_id: this.sessionId || undefined,\r\n      context\r\n    };\r\n\r\n    // Add user message to UI immediately\r\n    this.addMessage({\r\n      role: 'user',\r\n      content: message,\r\n      timestamp: new Date().toISOString()\r\n    });\r\n\r\n    // Add loading message\r\n    this.addMessage({\r\n      role: 'assistant',\r\n      content: '...',\r\n      timestamp: new Date().toISOString(),\r\n      isLoading: true\r\n    });\r\n\r\n    return this.http.post<ChatResponse>(`${this.apiUrl}/chat`, request).pipe(\r\n      tap(response => {\r\n        // Store session ID\r\n        if (response.session_id) {\r\n          this.sessionId = response.session_id;\r\n          this.saveSessionToStorage();\r\n        }\r\n\r\n        // Remove loading message\r\n        this.removeLoadingMessage();\r\n\r\n        // Add assistant response\r\n        this.addMessage({\r\n          role: 'assistant',\r\n          content: this.formatResponseMessage(response),\r\n          timestamp: response.timestamp,\r\n          intent: response.intent,\r\n          confidence: response.confidence\r\n        });\r\n      }),\r\n      catchError(error => {\r\n        this.removeLoadingMessage();\r\n        this.addMessage({\r\n          role: 'assistant',\r\n          content: '❌ Sorry, I encountered an error processing your request. Please try again.',\r\n          timestamp: new Date().toISOString()\r\n        });\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get system capabilities\r\n   */\r\n  getCapabilities(): Observable<{ capabilities: Capability[], notes: string[] }> {\r\n    return this.http.get<{ capabilities: Capability[], notes: string[] }>(\r\n      `${this.apiUrl}/capabilities`\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get conversation history\r\n   */\r\n  getConversationHistory(): Observable<ConversationHistory> {\r\n    if (!this.sessionId) {\r\n      return throwError(() => new Error('No active session'));\r\n    }\r\n\r\n    return this.http.get<ConversationHistory>(\r\n      `${this.apiUrl}/conversation/${this.sessionId}`\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Clear conversation\r\n   */\r\n  clearConversation(): Observable<void> {\r\n    if (this.sessionId) {\r\n      return this.http.delete<void>(`${this.apiUrl}/conversation/${this.sessionId}`).pipe(\r\n        tap(() => {\r\n          this.sessionId = null;\r\n          this.messagesSubject.next([]);\r\n          this.clearSessionFromStorage();\r\n        })\r\n      );\r\n    }\r\n\r\n    // If no session, just clear local messages\r\n    this.messagesSubject.next([]);\r\n    return new Observable(observer => {\r\n      observer.next();\r\n      observer.complete();\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get current session ID\r\n   */\r\n  getSessionId(): string | null {\r\n    return this.sessionId;\r\n  }\r\n\r\n  /**\r\n   * Format response message for display\r\n   */\r\n  private formatResponseMessage(response: ChatResponse): string {\r\n    let message = response.result.message;\r\n\r\n    // Add follow-up questions if any\r\n    if (response.follow_up_questions && response.follow_up_questions.length > 0) {\r\n      message += '\\n\\n**Follow-up questions:**\\n';\r\n      response.follow_up_questions.forEach((q, i) => {\r\n        message += `${i + 1}. ${q}\\n`;\r\n      });\r\n    }\r\n\r\n    return message;\r\n  }\r\n\r\n  /**\r\n   * Add message to conversation\r\n   */\r\n  private addMessage(message: Message): void {\r\n    const currentMessages = this.messagesSubject.value;\r\n    this.messagesSubject.next([...currentMessages, message]);\r\n  }\r\n\r\n  /**\r\n   * Remove loading message\r\n   */\r\n  private removeLoadingMessage(): void {\r\n    const currentMessages = this.messagesSubject.value;\r\n    const filtered = currentMessages.filter(m => !m.isLoading);\r\n    this.messagesSubject.next(filtered);\r\n  }\r\n\r\n  /**\r\n   * Save session to localStorage\r\n   */\r\n  private saveSessionToStorage(): void {\r\n    if (this.sessionId) {\r\n      localStorage.setItem('healthcare_session_id', this.sessionId);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Load session from localStorage\r\n   */\r\n  private loadSessionFromStorage(): void {\r\n    const stored = localStorage.getItem('healthcare_session_id');\r\n    if (stored) {\r\n      this.sessionId = stored;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear session from localStorage\r\n   */\r\n  private clearSessionFromStorage(): void {\r\n    localStorage.removeItem('healthcare_session_id');\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}